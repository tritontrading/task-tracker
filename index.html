<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Triton Trading Group – Task Tracker</title>
<link href="https://fonts.googleapis.com/css2?family=Syne:wght@700;800&family=DM+Sans:wght@300;400;500&display=swap" rel="stylesheet">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Nunito:ital,wght@0,200..1000;1,200..1000&display=swap" rel="stylesheet">
<style>
  *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

  :root {
    --bg: #111111;
    --surface: #1a1a1a;
    --surface2: #222222;
    --border: #2e2e2e;
    --text: #f0f0f0;
    --muted: #888;
    --tab-bg: #2a2a2a;
    --tab-active: #484848;
    --urgent: #f25c5c;
    --medium: #f5a623;
    --low: #e8d44d;
    --archive-check: #7c6af5;
    --modal-bg: rgba(28,28,28,0.97);
  }

  body {
    background: var(--bg);
    color: var(--text);
    font-family: 'DM Sans', sans-serif;
    font-size: 14px;
    min-height: 100vh;
  }

  .header {
    display: flex;
    justify-content: flex-end;
    align-items: center;
    gap: 10px;
    padding: 16px 32px;
  }
  .header-name {
    text-align: right;
    font-size: 13px;
    font-weight: 500;
    line-height: 1.3;
    color: var(--text);
  }
  .header-logo {
    width: 52px; height: 52px;
    border-radius: 50%;
    background: #1e2a3a;
    display: flex; align-items: center; justify-content: center;
    font-size: 24px;
    border: 2px solid #2e3d52;
    overflow: hidden;
  }
  .header-logo img { width: 100%; height: 100%; object-fit: cover; object-position: center; }


  .main { padding: 0 40px 60px; }

  h1 {
    font-family: "Nunito", sans-serif;
    font-optical-sizing: auto;
    font-weight: 800;
    font-style: normal;
    font-size: clamp(42px, 6vw, 64px);
    letter-spacing: -1px;
    margin-bottom: 28px;
    line-height: 1;

  }

  .tabs {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
    margin-bottom: 32px;
  }
  .tab-btn {
    background: var(--tab-bg);
    color: var(--text);
    border: none;
    border-radius: 8px;
    padding: 8px 16px;
    font-family: 'DM Sans', sans-serif;
    font-size: 13px;
    font-weight: 400;
    cursor: pointer;
    transition: background 0.15s;
  }
  .tab-btn:hover { background: #333; }
  .tab-btn.active { background: var(--tab-active); font-weight: 500; }

  .task-table { width: 100%; border-collapse: collapse; }
  .task-table thead tr { border-bottom: 1px solid var(--border); }
  .task-table th {
    color: var(--muted);
    font-weight: 400;
    font-size: 13px;
    padding: 0 12px 12px;
    text-align: left;
  }
  .task-table th:first-child { padding-left: 0; width: 60px; }
  .task-table th:nth-child(2) { width: 190px; }
  .task-table th:nth-child(4) { width: 130px; }
  .task-table th:nth-child(5) { width: 120px; }
  .task-table tbody tr {
    border-bottom: 1px solid #1e1e1e;
    transition: background 0.12s;
  }
  .task-table tbody tr:hover { background: #161616; }
  .task-table td { padding: 14px 12px; vertical-align: middle; }
  .task-table td:first-child { padding-left: 0; }

  .done-checkbox {
    width: 18px; height: 18px;
    border: 2px solid #555;
    border-radius: 3px;
    cursor: pointer;
    display: flex; align-items: center; justify-content: center;
    transition: border-color 0.15s, background 0.15s;
    flex-shrink: 0;
  }
  .done-checkbox:hover { border-color: #888; }
  .done-checkbox.checked-archive {
    background: var(--archive-check);
    border-color: var(--archive-check);
  }
  .done-checkbox.checked-archive::after {
    content: '';
    width: 9px; height: 9px;
    background: #fff;
    border-radius: 1px;
  }

  .team-badge {
    display: inline-flex;
    align-items: center;
    gap: 5px;
    padding: 4px 12px 4px 8px;
    border-radius: 999px;
    font-size: 12px;
    font-weight: 500;
    white-space: nowrap;
  }
  .team-badge .dot { width: 8px; height: 8px; border-radius: 50%; flex-shrink: 0; }

  .badge-executive       { background: rgba(120,120,130,0.35); color: #ccc; }
  .badge-executive .dot  { background: #aaa; }
  .badge-marketing       { background: rgba(255,150,180,0.25); color: #ffb3cc; }
  .badge-marketing .dot  { background: #ff80aa; }
  .badge-activities      { background: rgba(255,200,80,0.22); color: #ffd875; }
  .badge-activities .dot { background: #ffd875; }
  .badge-legalfinance      { background: rgba(100,160,255,0.22); color: #99c2ff; }
  .badge-legalfinance .dot { background: #99c2ff; }
  .badge-externalaffairs      { background: rgba(255,110,100,0.25); color: #ff9090; }
  .badge-externalaffairs .dot { background: #ff7070; }
  .badge-productmanagement      { background: rgba(255,180,100,0.25); color: #ffb870; }
  .badge-productmanagement .dot { background: #ffaa55; }  
  .badge-consulting      { background: rgba(100,230,220,0.2); color: #80e8e0; }
  .badge-consulting .dot { background: #60ddd4; }
  .badge-wealthmanagement      { background: rgba(120,220,120,0.22); color: #90e090; }
  .badge-wealthmanagement .dot { background: #70d870; }
  .badge-quant      { background: rgba(180,130,255,0.25); color: #c9a8ff; }
  .badge-quant .dot { background: #b088ff; }

  .urgency-pill {
    display: inline-flex;
    align-items: center;
    gap: 5px;
    padding: 4px 12px;
    border-radius: 999px;
    font-size: 12px;
    font-weight: 500;
  }
  .urgency-pill .dot { width: 7px; height: 7px; border-radius: 50%; }
  .pill-urgent { background: var(--urgent); color: #fff; }
  .pill-urgent .dot { background: rgba(255,255,255,0.7); }
  .pill-medium { background: var(--medium); color: #fff; }
  .pill-medium .dot { background: rgba(255,255,255,0.7); }
  .pill-low { background: var(--low); color: #222; }
  .pill-low .dot { background: rgba(0,0,0,0.25); }

  .task-desc { color: var(--text); line-height: 1.45; font-size: 13.5px; }
  .deadline-text { color: var(--text); font-size: 13px; }

  .add-task-row {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 18px 0 0;
    cursor: pointer;
    color: var(--text);
    font-size: 14px;
    width: fit-content;
    transition: opacity 0.15s;
  }
  .add-task-row:hover { opacity: 0.7; }
  .add-icon {
    width: 28px; height: 28px;
    border-radius: 50%;
    border: 2px solid var(--text);
    display: flex; align-items: center; justify-content: center;
    font-size: 18px;
    line-height: 1;
    flex-shrink: 0;
  }

  .modal-overlay {
    display: none;
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.6);
    z-index: 100;
    align-items: center;
    justify-content: center;
  }
  .modal-overlay.open { display: flex; }

  .modal {
    background: var(--modal-bg);
    backdrop-filter: blur(12px);
    border-radius: 18px;
    padding: 36px 40px 40px;
    width: 480px;
    max-width: 95vw;
    position: relative;
    border: 1px solid #333;
  }
  .modal h2 {
    font-family: 'Nunito', sans-serif;
    font-size: 32px;
    font-weight: 800;
    margin-bottom: 28px;
  }
  .modal-close {
    position: absolute;
    top: 20px; right: 24px;
    background: none; border: none;
    color: var(--muted);
    font-size: 22px;
    cursor: pointer;
    transition: color 0.15s;
  }
  .modal-close:hover { color: var(--text); }

  .modal-row {
    display: grid;
    grid-template-columns: 90px 1fr;
    align-items: center;
    margin-bottom: 22px;
    gap: 16px;
  }
  .modal-row label { font-size: 15px; color: var(--text); }
  .modal-row input,
  .modal-row select {
    background: transparent;
    border: none;
    border-bottom: 1px solid #555;
    color: var(--text);
    font-family: 'DM Sans', sans-serif;
    font-size: 14px;
    padding: 6px 4px;
    outline: none;
    width: 100%;
    transition: border-color 0.15s;
  }
  .modal-row input:focus,
  .modal-row select:focus { border-bottom-color: #aaa; }
  .modal-row select option { background: #2a2a2a; }

  .modal-submit {
    margin-top: 8px;
    width: 100%;
    background: #fff;
    color: #111;
    border: none;
    border-radius: 10px;
    padding: 12px;
    font-family: 'DM Sans', sans-serif;
    font-size: 15px;
    font-weight: 600;
    cursor: pointer;
    transition: opacity 0.15s;
  }
  .modal-submit:hover { opacity: 0.85; }
  .modal-submit:disabled { opacity: 0.4; cursor: not-allowed; }

  .empty-state { color: var(--muted); padding: 40px 0; font-size: 14px; }
  .archive-note { color: var(--muted); font-size: 12px; margin-bottom: 16px; font-style: italic; }

  /* COMPLETED TASK ROW */
  .task-row-completed td { opacity: 0.45; }
  .task-row-completed .task-desc { text-decoration: line-through; }
  .task-row-completed td:last-child { opacity: 1; }

  /* DONE CHECKBOX COMPLETED STATE */
  .done-checkbox.checked-done {
    background: #444;
    border-color: #444;
  }
  .done-checkbox.checked-done::after {
    content: '';
    width: 9px; height: 9px;
    background: #aaa;
    border-radius: 1px;
  }

  /* ACTION BUTTONS CELL */
  .action-btns {
    display: flex;
    gap: 6px;
    align-items: center;
  }
  .btn-archive-task {
    background: #2a2a2a;
    border: 1px solid #444;
    color: #aaa;
    border-radius: 6px;
    padding: 3px 9px;
    font-size: 11px;
    cursor: pointer;
    font-family: 'DM Sans', sans-serif;
    transition: background 0.15s, color 0.15s;
    white-space: nowrap;
  }
  .btn-archive-task:hover { background: #383838; color: #fff; }
  .btn-edit-task {
    background: #2a2a2a;
    border: 1px solid #444;
    color: #aaa;
    border-radius: 6px;
    padding: 3px 9px;
    font-size: 11px;
    cursor: pointer;
    font-family: 'DM Sans', sans-serif;
    transition: background 0.15s, color 0.15s;
    white-space: nowrap;
  }
  .btn-edit-task:hover { background: #383838; color: #fff; }

  .loading {
    color: var(--muted);
    padding: 40px 0;
    font-size: 14px;
    display: flex;
    align-items: center;
    gap: 10px;
  }
  .spinner {
    width: 16px; height: 16px;
    border: 2px solid #333;
    border-top-color: #888;
    border-radius: 50%;
    animation: spin 0.7s linear infinite;
  }
  @keyframes spin { to { transform: rotate(360deg); } }
</style>
</head>
<body>

<div class="header">
  <div class="header-name">Triton Trading<br>Group</div>
  <div class="header-logo"><img src="logo.png" alt="logo"></div>
</div>

<div class="main">
  <h1>Task Tracker</h1>
  <div class="tabs" id="tabs"></div>
  <div id="page-content"><div class="loading"><div class="spinner"></div> Loading tasks…</div></div>
</div>

<!-- MODAL -->
<div class="modal-overlay" id="modal-overlay">
  <div class="modal">
    <button class="modal-close" id="modal-close">✕</button>
    <h2>Add Task</h2>
    <div class="modal-row">
      <label>team</label>
      <select id="input-team">
        <option value="" disabled selected>choose</option>
        <option value="executive">Executive/Ops</option>
        <option value="marketing">Marketing</option>
        <option value="activities">Activities</option>
        <option value="legalfinance">Legal/Finance</option>
        <option value="externalaffairs">External Affairs</option>
        <option value="productmanagement">Product Management</option>
        <option value="consulting">Consulting</option>
        <option value="wealthmanagement">Wealth Management</option>
        <option value="quant">Quant</option>
      </select>
    </div>
    <div class="modal-row">
      <label>task</label>
      <input type="text" id="input-task" placeholder="describe the task…">
    </div>
    <div class="modal-row">
      <label>urgency</label>
      <select id="input-urgency">
        <option value="" disabled selected>choose</option>
        <option value="urgent">Urgent</option>
        <option value="medium">Medium</option>
        <option value="low">Low</option>
      </select>
    </div>
    <div class="modal-row">
      <label>deadline</label>
      <input type="text" id="input-deadline" placeholder="MM/DD/YYYY (optional)">
    </div>
    <button class="modal-submit" id="modal-submit">Add Task</button>
  </div>
</div>

<!-- EDIT MODAL -->
<div class="modal-overlay" id="edit-modal-overlay">
  <div class="modal">
    <button class="modal-close" id="edit-modal-close">✕</button>
    <h2>Edit Task</h2>
    <div class="modal-row">
      <label>team</label>
      <select id="edit-input-team">
        <option value="" disabled>choose</option>
        <option value="executive">Executive/Ops</option>
        <option value="marketing">Marketing</option>
        <option value="activities">Activities</option>
        <option value="legalfinance">Legal/Finance</option>
        <option value="externalaffairs">External Affairs</option>
        <option value="productmanagement">Product Management</option>
        <option value="consulting">Consulting</option>
        <option value="wealthmanagement">Wealth Management</option>
        <option value="quant">Quant</option>
      </select>
    </div>
    <div class="modal-row">
      <label>task</label>
      <input type="text" id="edit-input-task" placeholder="describe the task…">
    </div>
    <div class="modal-row">
      <label>urgency</label>
      <select id="edit-input-urgency">
        <option value="" disabled>choose</option>
        <option value="urgent">Urgent</option>
        <option value="medium">Medium</option>
        <option value="low">Low</option>
      </select>
    </div>
    <div class="modal-row">
      <label>deadline</label>
      <input type="text" id="edit-input-deadline" placeholder="MM/DD/YYYY (optional)">
    </div>
    <button class="modal-submit" id="edit-modal-submit">Save Changes</button>
  </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js";
import {
  getFirestore, collection, onSnapshot,
  addDoc, updateDoc, deleteDoc, doc, serverTimestamp, query, orderBy, limit
} from "https://www.gstatic.com/firebasejs/12.9.0/firebase-firestore.js";

// ── FIREBASE CONFIG ──────────────────────────────────────────────────────────
const firebaseConfig = {
  apiKey: "AIzaSyBj-Qf6g0oKlQxnQFqQMYq1ahgYjMxczCg",
  authDomain: "ttg-task-tracker.firebaseapp.com",
  projectId: "ttg-task-tracker",
  storageBucket: "ttg-task-tracker.firebasestorage.app",
  messagingSenderId: "928116643364",
  appId: "1:928116643364:web:65bcef79e7f2e114b72ab1",
  measurementId: "G-CKHRF192NS"
};

const app = initializeApp(firebaseConfig);
const db  = getFirestore(app);

// ── CONSTANTS ────────────────────────────────────────────────────────────────
const TEAMS = [
  { key: 'executive',         label: 'Executive/Ops' },
  { key: 'marketing',         label: 'Marketing' },
  { key: 'activities',        label: 'Activities' },
  { key: 'legalfinance',      label: 'Legal/Finance' },
  { key: 'externalaffairs',   label: 'External Affairs' },
  { key: 'productmanagement', label: 'Product Management' },
  { key: 'consulting',        label: 'Consulting' },
  { key: 'wealthmanagement',  label: 'Wealth Management' },
  { key: 'quant',             label: 'Quant' },
];
const URGENCY_ORDER = { urgent: 0, medium: 1, low: 2 };

let currentTab   = 'all';
let activeTasks  = [];
let archiveTasks = [];
let editingId    = null;

// ── FIRESTORE LISTENERS ──────────────────────────────────────────────────────
onSnapshot(collection(db, 'tasks'), snap => {
  activeTasks = snap.docs.map(d => ({ id: d.id, ...d.data() }));
  render();
});

onSnapshot(query(collection(db, 'archive'), orderBy('archivedAt', 'desc'), limit(15)), snap => {
  archiveTasks = snap.docs.map(d => ({ id: d.id, ...d.data() }));
  render();
});

// ── HELPERS ──────────────────────────────────────────────────────────────────
function teamLabel(key) {
  const t = TEAMS.find(t => t.key === key);
  return t ? t.label : key;
}
function escHtml(str) {
  return String(str).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;');
}
function teamBadgeHTML(key) {
  return `<span class="team-badge badge-${key}"><span class="dot"></span>${escHtml(teamLabel(key))}</span>`;
}
function urgencyPillHTML(u) {
  return `<span class="urgency-pill pill-${u}"><span class="dot"></span>${u.charAt(0).toUpperCase()+u.slice(1)}</span>`;
}

// ── RENDER ───────────────────────────────────────────────────────────────────
function renderTabs() {
  const tabDefs = [
    { key: 'all', label: 'All Tasks' },
    ...TEAMS.map(t => ({ key: t.key, label: t.label })),
    { key: 'archive', label: 'Archive' },
  ];
  document.getElementById('tabs').innerHTML = tabDefs.map(t =>
    `<button class="tab-btn ${currentTab === t.key ? 'active' : ''}" data-tab="${t.key}">${t.label}</button>`
  ).join('');
  document.getElementById('tabs').querySelectorAll('.tab-btn').forEach(btn => {
    btn.addEventListener('click', () => { currentTab = btn.dataset.tab; render(); });
  });
}

function renderActiveTable(tasks) {
  // Split into active (not done) and completed (done)
  const active    = tasks.filter(t => !t.done);
  const completed = tasks.filter(t => t.done);

  // Sort active by urgency, completed go to bottom
  const sortedActive = [...active].sort((a, b) => URGENCY_ORDER[a.urgency] - URGENCY_ORDER[b.urgency]);
  const allRows = [...sortedActive, ...completed];

  if (allRows.length === 0) return `<p class="empty-state">No tasks here yet.</p>`;

  const rows = allRows.map(t => {
    const isDone = !!t.done;
    return `
      <tr class="${isDone ? 'task-row-completed' : ''}">
        <td>
          <div class="done-checkbox ${isDone ? 'checked-done' : ''}" data-id="${t.id}" data-action="toggle"></div>
        </td>
        <td>${teamBadgeHTML(t.team)}</td>
        <td><span class="task-desc">${escHtml(t.desc)}</span></td>
        <td>${urgencyPillHTML(t.urgency)}</td>
        <td><span class="deadline-text">${escHtml(t.deadline || '—')}</span></td>
        <td>
          <div class="action-btns">
            <button class="btn-edit-task" data-id="${t.id}">edit</button>
            ${isDone ? `<button class="btn-archive-task" data-id="${t.id}">archive</button>` : ''}
          </div>
        </td>
      </tr>
    `;
  }).join('');

  return `
    <table class="task-table">
      <thead><tr>
        <th>done</th><th>team</th><th>task</th><th>urgency</th><th>deadline</th><th></th>
      </tr></thead>
      <tbody>${rows}</tbody>
    </table>
  `;
}

function renderArchiveTable(tasks) {
  if (tasks.length === 0) return `<p class="empty-state">No archived tasks yet.</p>`;
  const rows = tasks.map(t => `
    <tr>
      <td><div class="done-checkbox checked-archive" data-id="${t.id}" data-action="restore"></div></td>
      <td>${teamBadgeHTML(t.team)}</td>
      <td><span class="task-desc">${escHtml(t.desc)}</span></td>
      <td>${urgencyPillHTML(t.urgency)}</td>
      <td><span class="deadline-text">${escHtml(t.deadline || '—')}</span></td>
      <td></td>
    </tr>
  `).join('');
  return `
    <table class="task-table">
      <thead><tr>
        <th>done</th><th>team</th><th>task</th><th>urgency</th><th>deadline</th><th></th>
      </tr></thead>
      <tbody>${rows}</tbody>
    </table>
  `;
}

function render() {
  renderTabs();
  const content = document.getElementById('page-content');

  if (currentTab === 'archive') {
    content.innerHTML = `
      <p class="archive-note">Showing up to 15 most recently archived tasks. Click the checkbox to restore a task to active.</p>
      ${renderArchiveTable(archiveTasks)}
    `;
  } else {
    const filtered = currentTab === 'all'
      ? activeTasks
      : activeTasks.filter(t => t.team === currentTab);

    content.innerHTML = `
      ${renderActiveTable(filtered)}
      <div class="add-task-row" id="add-task-btn">
        <div class="add-icon">+</div>
        <span>add task</span>
      </div>
    `;
    document.getElementById('add-task-btn').addEventListener('click', openModal);
  }

  // Done checkbox toggle
  content.querySelectorAll('.done-checkbox[data-action="toggle"]').forEach(el => {
    el.addEventListener('click', () => toggleDone(el.dataset.id));
  });

  // Restore from archive
  content.querySelectorAll('.done-checkbox[data-action="restore"]').forEach(el => {
    el.addEventListener('click', () => restoreTask(el.dataset.id));
  });

  // Archive button (manual, only on completed tasks)
  content.querySelectorAll('.btn-archive-task').forEach(el => {
    el.addEventListener('click', () => archiveTask(el.dataset.id));
  });

  // Edit button
  content.querySelectorAll('.btn-edit-task').forEach(el => {
    el.addEventListener('click', () => openEditModal(el.dataset.id));
  });
}

// ── TASK ACTIONS ─────────────────────────────────────────────────────────────
async function toggleDone(id) {
  const task = activeTasks.find(t => t.id === id);
  if (!task) return;
  await updateDoc(doc(db, 'tasks', id), { done: !task.done });
}

async function archiveTask(id) {
  const task = activeTasks.find(t => t.id === id);
  if (!task) return;
  await addDoc(collection(db, 'archive'), { ...task, archivedAt: serverTimestamp() });
  await deleteDoc(doc(db, 'tasks', id));
}

async function restoreTask(id) {
  const task = archiveTasks.find(t => t.id === id);
  if (!task) return;
  const { archivedAt, ...rest } = task;
  await addDoc(collection(db, 'tasks'), { ...rest, done: false, createdAt: serverTimestamp() });
  await deleteDoc(doc(db, 'archive', id));
}

// ── ADD MODAL ────────────────────────────────────────────────────────────────
function openModal() {
  const teamSelect = document.getElementById('input-team');
  teamSelect.value = (currentTab !== 'all' && currentTab !== 'archive') ? currentTab : '';
  document.getElementById('input-task').value     = '';
  document.getElementById('input-urgency').value  = '';
  document.getElementById('input-deadline').value = '';
  document.getElementById('modal-overlay').classList.add('open');
}
function closeModal() {
  document.getElementById('modal-overlay').classList.remove('open');
}

document.getElementById('modal-close').addEventListener('click', closeModal);
document.getElementById('modal-overlay').addEventListener('click', e => {
  if (e.target === document.getElementById('modal-overlay')) closeModal();
});

document.getElementById('modal-submit').addEventListener('click', async () => {
  const team     = document.getElementById('input-team').value;
  const desc     = document.getElementById('input-task').value.trim();
  const urgency  = document.getElementById('input-urgency').value;
  const deadline = document.getElementById('input-deadline').value.trim();

  if (!team || !desc || !urgency) {
    alert('Please fill in team, task description, and urgency.');
    return;
  }

  const btn = document.getElementById('modal-submit');
  btn.disabled = true;
  btn.textContent = 'Adding…';

  await addDoc(collection(db, 'tasks'), {
    team, desc, urgency, deadline, done: false, createdAt: serverTimestamp()
  });

  btn.disabled = false;
  btn.textContent = 'Add Task';
  closeModal();
});

// ── EDIT MODAL ───────────────────────────────────────────────────────────────
function openEditModal(id) {
  const task = activeTasks.find(t => t.id === id);
  if (!task) return;
  editingId = id;
  document.getElementById('edit-input-team').value    = task.team;
  document.getElementById('edit-input-task').value    = task.desc;
  document.getElementById('edit-input-urgency').value = task.urgency;
  document.getElementById('edit-input-deadline').value = task.deadline || '';
  document.getElementById('edit-modal-overlay').classList.add('open');
}
function closeEditModal() {
  document.getElementById('edit-modal-overlay').classList.remove('open');
  editingId = null;
}

document.getElementById('edit-modal-close').addEventListener('click', closeEditModal);
document.getElementById('edit-modal-overlay').addEventListener('click', e => {
  if (e.target === document.getElementById('edit-modal-overlay')) closeEditModal();
});

document.getElementById('edit-modal-submit').addEventListener('click', async () => {
  if (!editingId) return;
  const team     = document.getElementById('edit-input-team').value;
  const desc     = document.getElementById('edit-input-task').value.trim();
  const urgency  = document.getElementById('edit-input-urgency').value;
  const deadline = document.getElementById('edit-input-deadline').value.trim();

  if (!team || !desc || !urgency) {
    alert('Please fill in team, task description, and urgency.');
    return;
  }

  const btn = document.getElementById('edit-modal-submit');
  btn.disabled = true;
  btn.textContent = 'Saving…';

  await updateDoc(doc(db, 'tasks', editingId), { team, desc, urgency, deadline });

  btn.disabled = false;
  btn.textContent = 'Save Changes';
  closeEditModal();
});
</script>
</body>
</html>
